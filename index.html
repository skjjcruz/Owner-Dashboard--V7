<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Draft Board v2.0</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="./csv-loader.js"></script>
  <style>
    body { margin: 0; padding: 0; overflow: hidden; }
    .scroll-container {
      scrollbar-width: thin;
      scrollbar-color: #475569 #1e293b;
    }
    .scroll-container::-webkit-scrollbar { width: 8px; }
    .scroll-container::-webkit-scrollbar-track { background: #1e293b; }
    .scroll-container::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }

    /* Mobile optimizations for phones only */
    @media (max-width: 768px) {
      .mobile-compact { font-size: 0.75rem; }
      .mobile-compact-xs { font-size: 0.65rem; }
      .mobile-padding { padding: 0.5rem; }
      .mobile-gap { gap: 0.5rem; }

      /* More aggressive phone-specific optimizations */
      .font-bold { font-weight: 600 !important; }
      h2 { font-size: 0.875rem !important; }
      h3 { font-size: 0.8rem !important; }

      /* Draft Board optimizations */
      .draft-board-container .space-y-2 { gap: 0.25rem !important; }
      .draft-board-pick { padding: 0.5rem !important; }
      .pick-number { font-size: 0.7rem !important; }
      .pick-overall { font-size: 0.6rem !important; }
      .pick-name { font-size: 0.7rem !important; }
      .pick-details { font-size: 0.6rem !important; }

      /* Player Rankings optimizations */
      .player-card-mobile { padding: 0.5rem 0.25rem !important; }
      .player-name { font-size: 0.7rem !important; line-height: 1.2 !important; }
      .player-details { font-size: 0.6rem !important; line-height: 1.1 !important; }
      .player-rank-number { font-size: 0.65rem !important; }

      /* Position filters - better spacing */
      .position-filter-btn {
        font-size: 0.65rem !important;
        padding: 0.5rem 0.8rem !important;
        margin: 0.2rem !important;
      }

      /* Ranking mode buttons - more compact */
      .ranking-mode-btn {
        font-size: 0.6rem !important;
        padding: 0.25rem 0.375rem !important;
      }

      /* Search bar - more compact */
      .search-input-mobile {
        font-size: 0.7rem !important;
        padding: 0.375rem 0.5rem !important;
      }
    }

    /* Info icon in top-right corner of player cards */
.player-info-icon {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    background: rgba(102, 126, 234, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s ease;
    border: 2px solid white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.player-info-icon:hover {
    background: rgba(118, 75, 162, 1);
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.player-card {
    position: relative;
}

  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const SPORT = "nfl";
    const DEFAULT_LEAGUE_SEASON = "2026";
    const DEFAULT_STATS_SEASON = "2025";
    const LS_LOCKED_USERNAME = "draft_board_v2_username";

    const mockPlayers = [
      { id: 1, name: 'Cameron Ward', pos: 'QB', school: 'Miami', size: '6\'2"', weight: 223, speed: 4.58, tier: 1 },
      { id: 2, name: 'Shedeur Sanders', pos: 'QB', school: 'Colorado', size: '6\'2"', weight: 215, speed: 4.6, tier: 1 },
      { id: 3, name: 'Quinn Ewers', pos: 'QB', school: 'Texas', size: '6\'2"', weight: 195, speed: 4.7, tier: 1 },
      { id: 4, name: 'Riley Leonard', pos: 'QB', school: 'Notre Dame', size: '6\'4"', weight: 212, speed: 4.5, tier: 2 },
      { id: 5, name: 'Ashton Jeanty', pos: 'RB', school: 'Boise State', size: '5\'9"', weight: 215, speed: 4.42, tier: 1 },
      { id: 6, name: 'Omarion Hampton', pos: 'RB', school: 'UNC', size: '6\'0"', weight: 220, speed: 4.5, tier: 1 },
      { id: 7, name: 'Travis Hunter', pos: 'WR', school: 'Colorado', size: '6\'1"', weight: 185, speed: 4.3, tier: 1 },
      { id: 8, name: 'Tetairoa McMillan', pos: 'WR', school: 'Arizona', size: '6\'5"', weight: 210, speed: 4.5, tier: 1 },
      { id: 9, name: 'Emeka Egbuka', pos: 'WR', school: 'Ohio State', size: '6\'1"', weight: 206, speed: 4.3, tier: 1 },
      { id: 10, name: 'Abdul Carter', pos: 'EDGE', school: 'Penn State', size: '6\'3"', weight: 252, speed: 4.4, tier: 1 },
    ];

    const positions = ['QB', 'RB', 'WR', 'TE', 'EDGE', 'DL', 'LB', 'CB', 'S', 'K'];

    async function fetchJSON(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    // Read URL parameters
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        username: params.get('username') || '',
        season: params.get('season') || DEFAULT_LEAGUE_SEASON
      };
    }

    const DraftBoard = () => {
      const [numTeams] = useState(16);
      const [numRounds] = useState(7);
      const [draftType] = useState('snake');
      const [selectedPos, setSelectedPos] = useState('ALL');
      const [searchTerm, setSearchTerm] = useState('');
      const [rankingMode, setRankingMode] = useState('fantasy'); // 'consensus' or 'fantasy'
      const [players, setPlayers] = useState([]);
      const [draftPicks, setDraftPicks] = useState({});
      const [selectedPickSlot, setSelectedPickSlot] = useState(null);
      const [selectedPlayerDetail, setSelectedPlayerDetail] = useState(null);
      
      // Get URL params on mount
      const urlParams = getUrlParams();
      
      const [sleeperUsername, setSleeperUsername] = useState(() => {
        return urlParams.username || localStorage.getItem(LS_LOCKED_USERNAME) || 'skjjcruz';
      });
      const [sleeperUserId, setSleeperUserId] = useState(null);
      const [userLeagues, setUserLeagues] = useState([]);
      const [selectedLeague, setSelectedLeague] = useState(null);
      const [leagueSeason, setLeagueSeason] = useState(urlParams.season || DEFAULT_LEAGUE_SEASON);
      const [statsSeason, setStatsSeason] = useState(DEFAULT_STATS_SEASON);
      const [loading, setLoading] = useState(false);
      const [status, setStatus] = useState('Loading from dashboard...');
      
      // Draft history
      const [availableDrafts, setAvailableDrafts] = useState([]);
      const [selectedDraft, setSelectedDraft] = useState(null);
      const [draftYear, setDraftYear] = useState(null);
      const [sleeperPlayers, setSleeperPlayers] = useState(null);
      const [leagueRosters, setLeagueRosters] = useState([]);
      const [leagueUsers, setLeagueUsers] = useState([]);

      // Auto-load on mount if we have URL params
      useEffect(() => {
        if (urlParams.username) {
          fetchSleeperUser(urlParams.username);
        } else if (localStorage.getItem(LS_LOCKED_USERNAME)) {
          fetchSleeperUser(localStorage.getItem(LS_LOCKED_USERNAME));
        } else {
          setStatus('Enter Sleeper username and click Reload');
        }
      }, []);

      // Load players from CSV files
      useEffect(() => {
        loadPlayersFromCSV()
          .then(data => {
            console.log(`Loaded ${data.length} players from CSV files`);
            setPlayers(data);
          })
          .catch(err => {
            console.error('Error loading players:', err);
            // Fallback to mock players if CSV fails to load
            setPlayers(mockPlayers);
          });
      }, []);

      const fetchSleeperUser = async (username) => {
        if (!username) {
          setStatus('Enter a Sleeper username.');
          return;
        }
        
        setLoading(true);
        
        try {
          setStatus('Loading Sleeper user‚Ä¶');
          const userData = await fetchJSON(`https://api.sleeper.app/v1/user/${encodeURIComponent(username)}`);
          setSleeperUserId(userData.user_id);
          localStorage.setItem(LS_LOCKED_USERNAME, username);
          
          setStatus('Loading leagues‚Ä¶');
          const leaguesData = await fetchJSON(
            `https://api.sleeper.app/v1/user/${userData.user_id}/leagues/${SPORT}/${leagueSeason}`
          );
          
          if (!leaguesData || leaguesData.length === 0) {
            setStatus('No leagues found for that season.');
            setUserLeagues([]);
            return;
          }
          
          const mappedLeagues = leaguesData.map(league => ({
            id: league.league_id,
            name: league.name,
            type: league.settings?.type || 'redraft',
            totalRosters: league.total_rosters,
            season: league.season,
            status: league.status,
            draftId: league.draft_id
          }));
          
          setUserLeagues(mappedLeagues);
          
          let auto = mappedLeagues[0];
          const psycho = mappedLeagues.find(l => (l.name || '').toLowerCase().includes('psycho'));
          if (psycho) auto = psycho;
          
          setSelectedLeague(auto);
          
          // Load drafts for selected league
          await loadDraftsForLeague(auto.id);
          
          setStatus(`Leagues loaded ‚úÖ - ${mappedLeagues.length} league(s) found`);
          
        } catch (err) {
          setStatus(`Error: ${err.message}`);
          console.error('Sleeper API Error:', err);
        } finally {
          setLoading(false);
        }
      };

      const loadDraftsForLeague = async (leagueId) => {
        if (!leagueId) return;
        
        try {
          setStatus('Loading draft history‚Ä¶');
          
          // Load league rosters and users for owner info
          const [draftsData, rostersData, usersData] = await Promise.all([
            fetchJSON(`https://api.sleeper.app/v1/league/${leagueId}/drafts`),
            fetchJSON(`https://api.sleeper.app/v1/league/${leagueId}/rosters`),
            fetchJSON(`https://api.sleeper.app/v1/league/${leagueId}/users`)
          ]);
          
          setLeagueRosters(rostersData || []);
          setLeagueUsers(usersData || []);
          
          if (!draftsData || draftsData.length === 0) {
            setAvailableDrafts([]);
            setSelectedDraft(null);
            setDraftYear(null);
            setStatus('No drafts found for this league.');
            return;
          }
          
          // Sort drafts by most recent first
          const sortedDrafts = draftsData.sort((a, b) => {
            return Number(b.season || 0) - Number(a.season || 0);
          });
          
          setAvailableDrafts(sortedDrafts);
          
          // Auto-select most recent draft
          const mostRecent = sortedDrafts[0];
          setSelectedDraft(mostRecent);
          setDraftYear(mostRecent.season);
          
          // Load picks for this draft
          await loadDraftPicks(mostRecent.draft_id);
          
        } catch (err) {
          console.error('Error loading drafts:', err);
          setStatus('Failed to load draft history.');
        }
      };

      const loadDraftPicks = async (draftId) => {
        if (!draftId) return;
        
        try {
          setStatus('Loading draft picks‚Ä¶');
          
          // Load Sleeper player database if not already loaded
          if (!sleeperPlayers) {
            setStatus('Loading player database‚Ä¶');
            const playersData = await fetchJSON(`https://api.sleeper.app/v1/players/${SPORT}`);
            setSleeperPlayers(playersData);
          }
          
          const picksData = await fetchJSON(`https://api.sleeper.app/v1/draft/${draftId}/picks`);
          
          if (!picksData || picksData.length === 0) {
            setDraftPicks({});
            setStatus('No picks found for this draft.');
            return;
          }
          
          // Map picks to our format with player data
          const mappedPicks = {};
          picksData.forEach(pick => {
            const key = `${pick.round}.${String(pick.draft_slot).padStart(2, '0')}`;
            mappedPicks[key] = {
              playerId: pick.player_id,
              metadata: pick.metadata,
              pickedBy: pick.picked_by
            };
          });
          
          setDraftPicks(mappedPicks);
          setStatus(`Draft loaded ‚úÖ - ${picksData.length} picks`);
          
        } catch (err) {
          console.error('Error loading picks:', err);
          setStatus('Failed to load draft picks.');
        }
      };

      const handleDraftYearChange = (year) => {
        const draft = availableDrafts.find(d => d.season === year);
        if (draft) {
          setSelectedDraft(draft);
          setDraftYear(year);
          loadDraftPicks(draft.draft_id);
        }
      };

      const handleLeagueChange = (leagueId) => {
        const league = userLeagues.find(l => l.id === leagueId);
        setSelectedLeague(league);
        loadDraftsForLeague(leagueId);
      };

      const handleReload = () => {
        fetchSleeperUser(sleeperUsername);
      };

      const handleBackToDashboard = () => {
        // Always navigate back to the dashboard URL
        window.location.href = 'https://skjjcruz.github.io/fantasy-football-owner-dashboard/';
      };

      const generateDraftOrder = () => {
        const order = [];
        for (let round = 1; round <= numRounds; round++) {
          for (let team = 1; team <= numTeams; team++) {
            const pickNum = draftType === 'snake' && round % 2 === 0 
              ? numTeams - team + 1 
              : team;
            order.push({
              round,
              pick: pickNum,
              overall: (round - 1) * numTeams + team,
              team: pickNum,
              key: `${round}.${String(pickNum).padStart(2, '0')}`
            });
          }
        }
        return order;
      };

      const draftOrder = generateDraftOrder();

      const filteredPlayers = players
        .filter(p => {
          const matchesPos = selectedPos === 'ALL' || p.pos === selectedPos;
          const matchesSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                               (p.school && p.school.toLowerCase().includes(searchTerm.toLowerCase()));
          const notDrafted = !Object.values(draftPicks).includes(p.id);
          return matchesPos && matchesSearch && notDrafted;
        })
        .sort((a, b) => {
          if (rankingMode === 'fantasy') {
            // For fantasy, sort by draftScore descending (higher is better)
            return (b.draftScore || 0) - (a.draftScore || 0);
          } else {
            // For consensus, sort by consensusRank ascending (lower is better)
            return (a.consensusRank || 999) - (b.consensusRank || 999);
          }
        });

      const positionCounts = positions.reduce((acc, pos) => {
        acc[pos] = players.filter(p => p.pos === pos && !Object.values(draftPicks).includes(p.id)).length;
        return acc;
      }, {});
      const totalAvailable = players.filter(p => !Object.values(draftPicks).includes(p.id)).length;

      const handlePlayerClick = (player) => {
        if (!selectedPickSlot) {
          const nextPick = draftOrder.find(pick => !draftPicks[pick.key]);
          if (nextPick) {
            setDraftPicks(prev => ({ ...prev, [nextPick.key]: player.id }));
          }
        } else {
          setDraftPicks(prev => ({ ...prev, [selectedPickSlot]: player.id }));
          setSelectedPickSlot(null);
        }
      };

      const handlePickSlotClick = (pickKey) => {
        if (draftPicks[pickKey]) {
          const newPicks = { ...draftPicks };
          delete newPicks[pickKey];
          setDraftPicks(newPicks);
        } else {
          setSelectedPickSlot(pickKey);
        }
      };

      const picksByRound = draftOrder.reduce((acc, pick) => {
        if (!acc[pick.round]) acc[pick.round] = [];
        acc[pick.round].push(pick);
        return acc;
      }, {});

      return (
        <div className="min-h-screen bg-slate-950 text-slate-100">
          <div className="bg-slate-900 border-b border-slate-700 px-2 md:px-4 py-1.5 md:py-3">
            <div className="overflow-x-auto">
              <div className="flex gap-2 items-center min-w-max justify-between">
                <div className="flex gap-2 items-center">
                  <input
                    type="text"
                    placeholder="Username"
                    value={sleeperUsername}
                    onChange={(e) => setSleeperUsername(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleReload()}
                    className="bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs text-slate-100 w-20 md:w-32"
                  />

                  <label className="text-xs text-slate-400 whitespace-nowrap">League Season:</label>
                  <select
                    value={leagueSeason}
                    onChange={(e) => setLeagueSeason(e.target.value)}
                    className="bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs text-slate-100"
                  >
                    {['2026', '2025', '2024', '2023'].map(year => (
                      <option key={year} value={year}>{year}</option>
                    ))}
                  </select>

                  <label className="text-xs text-slate-400 whitespace-nowrap">Stats Season:</label>
                  <select
                    value={statsSeason}
                    onChange={(e) => setStatsSeason(e.target.value)}
                    className="bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs text-slate-100"
                  >
                    {['2025', '2024', '2023', '2022'].map(year => (
                      <option key={year} value={year}>{year}</option>
                    ))}
                  </select>

                  <select
                    value={selectedLeague?.id || ''}
                    onChange={(e) => handleLeagueChange(e.target.value)}
                    className="bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs text-slate-100 max-w-[140px] md:min-w-[200px]"
                    disabled={loading || userLeagues.length === 0}
                  >
                    {userLeagues.length === 0 ? (
                      <option value="">No leagues</option>
                    ) : (
                      userLeagues.map(league => (
                        <option key={league.id} value={league.id}>{league.name}</option>
                      ))
                    )}
                  </select>

                  <select
                    value={draftYear || ''}
                    onChange={(e) => handleDraftYearChange(e.target.value)}
                    className="bg-slate-800 border border-slate-600 rounded px-2 py-1 text-xs text-slate-100"
                    disabled={loading || availableDrafts.length === 0}
                  >
                    {availableDrafts.length === 0 ? (
                      <option value="">No drafts</option>
                    ) : (
                      availableDrafts.map(draft => (
                        <option key={draft.draft_id} value={draft.season}>
                          {draft.season} {draft.status === 'complete' ? '‚úì' : draft.status === 'in_progress' ? '‚è≥' : ''}
                        </option>
                      ))
                    )}
                  </select>
                </div>

                <div className="flex gap-2 items-center">
                  <button
                    onClick={() => setDraftPicks({})}
                    className="px-2 py-1 bg-red-600 hover:bg-red-700 rounded text-xs font-bold text-white whitespace-nowrap"
                  >
                    Clear
                  </button>

                  <button
                    onClick={handleReload}
                    disabled={loading || !sleeperUsername}
                    className="px-3 py-1 bg-yellow-500 hover:bg-yellow-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-slate-900 rounded text-xs font-bold whitespace-nowrap"
                  >
                    {loading ? '...' : 'Reload'}
                  </button>

                  <button
                    onClick={handleBackToDashboard}
                    className="px-3 py-1 bg-slate-700 hover:bg-slate-600 text-slate-100 rounded text-xs font-bold whitespace-nowrap"
                  >
                    ‚Üê Back
                  </button>
                </div>
              </div>
            </div>

            <div className="mt-1 text-[10px] text-slate-500 truncate px-2">
              {status}
            </div>
          </div>

          <div className="flex gap-1 md:gap-4 p-1 md:p-4 h-[calc(100vh-80px)] md:h-[calc(100vh-100px)]">
            <div className="w-1/2 bg-slate-900 border border-slate-700 rounded-lg overflow-hidden flex flex-col">
              <div className="bg-slate-800 px-2 md:px-4 py-2 md:py-3 border-b border-slate-700 flex-shrink-0">
                <h2 className="font-bold text-yellow-500 text-sm md:text-base">Draft Board</h2>
              </div>

              <div className="flex-1 p-1 md:p-4 space-y-2 md:space-y-6 overflow-y-auto scroll-container draft-board-container">
                {Object.entries(picksByRound).map(([round, picks]) => (
                  <div key={round}>
                    <div className="sticky top-0 bg-slate-900 py-0.5 md:py-2 mb-1 md:mb-3 border-b-2 border-yellow-500 z-10">
                      <h3 className="font-bold text-yellow-500 text-xs md:text-lg">Round {round}</h3>
                    </div>

                    <div className="space-y-1 md:space-y-2">
                      {picks.map(pick => {
                        const pickData = draftPicks[pick.key];
                        const isSelected = selectedPickSlot === pick.key;

                        let player = null;
                        let displayName = 'Available';
                        let displayDetails = null;
                        let ownerInfo = null;
                        let isMyPick = false;
                        let playerRank = null;

                        if (pickData) {
                          // Check if it's historical Sleeper data
                          if (typeof pickData === 'object' && pickData.playerId) {
                            const sleeperPlayer = sleeperPlayers?.[pickData.playerId];
                            if (sleeperPlayer) {
                              displayName = sleeperPlayer.full_name || sleeperPlayer.first_name + ' ' + sleeperPlayer.last_name || 'Unknown Player';
                              displayDetails = `${sleeperPlayer.position || ''} ‚Ä¢ ${sleeperPlayer.team || 'FA'}`;
                            } else {
                              displayName = pickData.metadata?.first_name && pickData.metadata?.last_name
                                ? `${pickData.metadata.first_name} ${pickData.metadata.last_name}`
                                : 'Unknown Player';
                              displayDetails = pickData.metadata?.position || '';
                            }

                            // Get owner info
                            const pickedByUserId = pickData.pickedBy;
                            const owner = leagueUsers.find(u => u.user_id === pickedByUserId);
                            if (owner) {
                              ownerInfo = {
                                name: owner.display_name || owner.username,
                                avatar: owner.avatar
                              };
                              // Check if this is the logged-in user's pick
                              isMyPick = pickedByUserId === sleeperUserId;
                            }
                          } else {
                            // Mock player data (for manual drafting)
                            player = players.find(p => p.id === pickData);
                            if (player) {
                              displayName = player.name;
                              displayDetails = `${player.pos} ‚Ä¢ ${player.school}`;
                              // Get the rank based on current ranking mode
                              playerRank = rankingMode === 'fantasy' ? player.fantasyRank : player.rank;
                            }
                          }
                        }
                        
                        return (
                          <div
                            key={pick.key}
                            onClick={() => handlePickSlotClick(pick.key)}
                            className={`draft-board-pick p-1 md:p-3 rounded border cursor-pointer transition-all flex items-center gap-1 md:gap-3 ${
                              isSelected ? 'border-yellow-500 bg-yellow-500 bg-opacity-10' :
                              isMyPick ? 'border-emerald-600 bg-emerald-900 bg-opacity-40' :
                              pickData ? 'border-slate-600 bg-slate-800' :
                              'border-slate-600 bg-slate-800 hover:border-slate-500'
                            }`}
                          >
                            <div className="w-10 md:w-20 text-center flex-shrink-0">
                              <div className="pick-number font-bold text-yellow-500 text-xs md:text-base">{pick.key}</div>
                              {playerRank && (
                                <div className="pick-overall text-slate-500 text-[9px] md:text-xs mt-0.5">#{playerRank}</div>
                              )}
                            </div>

                            <div className="flex-1 min-w-0">
                              <div className="pick-name font-bold truncate text-xs md:text-base">{displayName}</div>
                              {displayDetails && (
                                <div className="pick-details text-[9px] md:text-sm text-slate-400 flex gap-0.5 md:gap-3 mt-0.5">
                                  {displayDetails}
                                </div>
                              )}
                              {ownerInfo && (
                                <div className="flex items-center gap-0.5 md:gap-2 mt-0.5 md:mt-1">
                                  {ownerInfo.avatar && (
                                    <img
                                      src={`https://sleepercdn.com/avatars/thumbs/${ownerInfo.avatar}`}
                                      alt=""
                                      className="w-2.5 h-2.5 md:w-5 md:h-5 rounded-full"
                                      onError={(e) => e.target.style.display = 'none'}
                                    />
                                  )}
                                  <span className="text-[9px] md:text-xs text-slate-500">
                                    {isMyPick ? '‚úì ' : ''}{ownerInfo.name}
                                  </span>
                                </div>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <div className="w-1/2 bg-slate-900 border border-slate-700 rounded-lg overflow-hidden flex flex-col">
              <div className="bg-slate-800 px-2 md:px-4 py-1 md:py-3 border-b border-slate-700 flex-shrink-0">
                <h2 className="hidden md:block font-bold text-yellow-500 mb-3 text-base">Player Rankings</h2>

                <input
                  type="text"
                  placeholder="Search..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="search-input-mobile w-full bg-slate-900 border border-slate-600 rounded px-2 md:px-3 py-0.5 md:py-2 text-xs md:text-sm text-slate-100 mb-1 md:mb-3"
                />

                <div className="flex gap-0.5 md:gap-2 mb-1 md:mb-3">
                  <button
                    onClick={() => setRankingMode('fantasy')}
                    className={`ranking-mode-btn flex-1 px-1 md:px-3 py-0 md:py-2 rounded text-xs md:text-sm font-semibold ${
                      rankingMode === 'fantasy' ? 'bg-purple-600 text-white' : 'bg-slate-700 text-slate-300'
                    }`}
                  >
                    üèà Fantasy Rank
                  </button>
                  <button
                    onClick={() => setRankingMode('consensus')}
                    className={`ranking-mode-btn flex-1 px-1 md:px-3 py-0 md:py-2 rounded text-xs md:text-sm font-semibold ${
                      rankingMode === 'consensus' ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-300'
                    }`}
                  >
                    üìä Consensus Rank
                  </button>
                </div>

                <div className="grid grid-cols-6 gap-1 md:gap-2">
                  <button
                    onClick={() => setSelectedPos('ALL')}
                    className={`position-filter-btn flex items-center justify-center px-0.5 md:px-3 py-0.5 md:py-1 rounded text-[4px] md:text-xs font-bold ${
                      selectedPos === 'ALL' ? 'bg-yellow-500 text-slate-900' : 'bg-slate-700'
                    }`}
                  >
                    ALL ({totalAvailable})
                  </button>
                  {positions.map(pos => (
                    <button
                      key={pos}
                      onClick={() => setSelectedPos(pos)}
                      className={`position-filter-btn flex items-center justify-center px-0.5 md:px-3 py-0.5 md:py-1 rounded text-[4px] md:text-xs font-bold ${
                        selectedPos === pos ? 'bg-yellow-500 text-slate-900' : 'bg-slate-700'
                      }`}
                    >
                      {pos} ({positionCounts[pos] || 0})
                    </button>
                  ))}
                </div>
              </div>

              <div className="flex-1 overflow-y-auto scroll-container">
                {filteredPlayers.map((player) => (
                  <div
                    key={player.id}
                    className="player-card-mobile p-1 md:p-3 hover:bg-slate-800 border-b border-slate-700"
                  >
                    <div className="flex items-center gap-0.5 md:gap-3">
                      <div className="player-rank-number w-7 md:w-12 text-slate-500 font-bold text-xs md:text-base text-center flex-shrink-0">
                        #{rankingMode === 'fantasy' ? player.fantasyRank : player.rank}
                      </div>
                      <div
                        className="flex-1 min-w-0 cursor-pointer"
                        onClick={() => handlePlayerClick(player)}
                      >
                        <div className="player-name font-bold text-xs md:text-base truncate flex items-center gap-1">
                          {player.name}
                        </div>
                        <div className="player-details text-[9px] md:text-xs text-slate-400 truncate">
                          {player.pos} ‚Ä¢ {player.school} ‚Ä¢ {player.size} ‚Ä¢ {player.weight} lbs
                        </div>
                      </div>
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setSelectedPlayerDetail(player);
                        }}
                        className="text-xs px-1.5 md:px-3 py-0.5 md:py-1.5 rounded bg-slate-700 hover:bg-slate-600 flex-shrink-0"
                      >
                        <span className="md:hidden">‚ÑπÔ∏è</span>
                        <span className="hidden md:inline">Details</span>
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Player Detail Modal */}
          {selectedPlayerDetail && (
            <div
              className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"
              onClick={() => setSelectedPlayerDetail(null)}
            >
              <div
                className="bg-slate-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-slate-700"
                onClick={(e) => e.stopPropagation()}
              >
                <div className="sticky top-0 bg-slate-800 px-6 py-4 border-b border-slate-700 flex justify-between items-center">
                  <h2 className="text-2xl font-bold text-yellow-500">{selectedPlayerDetail.name}</h2>
                  <button
                    onClick={() => setSelectedPlayerDetail(null)}
                    className="text-slate-400 hover:text-white text-2xl"
                  >
                    √ó
                  </button>
                </div>

                <div className="p-6">
                  {/* Player Info Badges */}
                  <div className="flex gap-3 mb-6">
                    <span className="px-3 py-1 bg-yellow-500 text-slate-900 rounded font-bold text-sm">
                      {selectedPlayerDetail.pos}
                    </span>
                    <span className="px-3 py-1 bg-slate-700 text-slate-100 rounded font-bold text-sm">
                      {selectedPlayerDetail.school}
                    </span>
                    <span className="px-3 py-1 bg-slate-700 text-slate-100 rounded font-bold text-sm">
                      {selectedPlayerDetail.year}
                    </span>
                  </div>

                  {/* Stats Grid */}
                  <div className="grid grid-cols-4 gap-4 mb-6">
                    <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                      <div className="text-slate-400 text-xs uppercase mb-1">Height</div>
                      <div className="text-yellow-500 text-xl font-bold">{selectedPlayerDetail.size || 'N/A'}</div>
                    </div>
                    <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                      <div className="text-slate-400 text-xs uppercase mb-1">Weight</div>
                      <div className="text-yellow-500 text-xl font-bold">{selectedPlayerDetail.weight ? selectedPlayerDetail.weight + ' lbs' : 'N/A'}</div>
                    </div>
                    <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                      <div className="text-slate-400 text-xs uppercase mb-1">40 Time</div>
                      <div className="text-yellow-500 text-xl font-bold">{selectedPlayerDetail.speed ? selectedPlayerDetail.speed + 's' : 'N/A'}</div>
                    </div>
                    <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                      <div className="text-slate-400 text-xs uppercase mb-1">Consensus Rank</div>
                      <div className="text-yellow-500 text-xl font-bold">#{selectedPlayerDetail.rank}</div>
                    </div>
                  </div>

                  {/* Fantasy Scoring */}
                  {selectedPlayerDetail.draftScore && (
                    <div className="bg-purple-900 bg-opacity-30 rounded-lg p-2 border border-purple-700 mb-6">
                      <h3 className="text-purple-400 font-bold text-sm mb-2 flex items-center gap-1">
                        üèà Fantasy Draft Score
                        {selectedPlayerDetail.isGenerational && (
                          <span className="text-yellow-400 text-xs">Generational</span>
                        )}
                      </h3>
                      <div className="grid grid-cols-4 gap-2">
                        <div>
                          <div className="text-slate-400 text-[10px] uppercase mb-0.5">Draft Score</div>
                          <div className="text-purple-400 text-base font-bold">{selectedPlayerDetail.draftScore}</div>
                        </div>
                        <div>
                          <div className="text-slate-400 text-[10px] uppercase mb-0.5">Fantasy Rank</div>
                          <div className="text-purple-400 text-base font-bold">#{selectedPlayerDetail.fantasyRank}</div>
                        </div>
                        <div>
                          <div className="text-slate-400 text-[10px] uppercase mb-0.5">Grade</div>
                          <div className="text-purple-400 text-base font-bold">{selectedPlayerDetail.grade}/10</div>
                        </div>
                        <div>
                          <div className="text-slate-400 text-[10px] uppercase mb-0.5">Position Mult</div>
                          <div className="text-purple-400 text-base font-bold">{selectedPlayerDetail.fantasyMultiplier}x</div>
                        </div>
                      </div>
                      <div className="mt-2 text-[10px] text-slate-400">
                        {selectedPlayerDetail.isGenerational && ['EDGE', 'LB', 'DL', 'S', 'CB'].includes(selectedPlayerDetail.pos) && (
                          <div className="text-yellow-400">
                            Elite defender bonus applied (+1.5)
                          </div>
                        )}
                        <div className="mt-0.5">
                          Formula: Grade ({selectedPlayerDetail.grade}) √ó Multiplier ({selectedPlayerDetail.fantasyMultiplier})
                          {selectedPlayerDetail.isGenerational && ['EDGE', 'LB', 'DL', 'S', 'CB'].includes(selectedPlayerDetail.pos) && ' + 1.5 (elite defender bonus)'}
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Source Rankings */}
                  <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                    <h3 className="text-yellow-500 font-bold text-lg mb-4">Source Rankings</h3>
                    {selectedPlayerDetail.sources && selectedPlayerDetail.sources.length > 0 ? (
                      <div className="overflow-x-auto">
                        <table className="w-full">
                          <thead>
                            <tr className="border-b border-slate-700">
                              <th className="text-left py-2 px-3 text-yellow-500 text-sm">Source</th>
                              <th className="text-right py-2 px-3 text-yellow-500 text-sm">Rank</th>
                            </tr>
                          </thead>
                          <tbody>
                            {selectedPlayerDetail.sources
                              .sort((a, b) => a.rank - b.rank)
                              .map((src, idx) => (
                                <tr key={idx} className="border-b border-slate-700 hover:bg-slate-700">
                                  <td className="py-2 px-3 text-slate-100">
                                    {src.source}
                                    {src.weight !== 1 && (
                                      <span className="ml-2 text-xs text-slate-500">
                                        (weight: {src.weight})
                                      </span>
                                    )}
                                  </td>
                                  <td className="py-2 px-3 text-right font-bold text-slate-100">
                                    #{src.rank}
                                  </td>
                                </tr>
                              ))}
                          </tbody>
                        </table>
                      </div>
                    ) : (
                      <div className="text-center py-4 text-slate-500">No source rankings available.</div>
                    )}
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<DraftBoard />, document.getElementById('root'));
  </script>

</body>
</html>
